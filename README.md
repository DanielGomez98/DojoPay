# ü•ã DojoPay - Sistema de Gesti√≥n para Artes Marciales

DojoPay es una aplicaci√≥n web progresiva (PWA) dise√±ada para simplificar la administraci√≥n de escuelas de Taekwondo y artes marciales. Permite controlar pagos, gestionar alumnos, tomar asistencia y visualizar m√©tricas financieras desde cualquier dispositivo (M√≥vil/PC).

![Estado](https://img.shields.io/badge/Estado-Producci√≥n-green)
![Tech](https://img.shields.io/badge/Stack-React%20%7C%20Vite%20%7C%20Supabase-blue)

## üöÄ Caracter√≠sticas Principales

* **üì± Dise√±o Responsivo & PWA:** Se instala como App nativa en iOS y Android.
* **üí∞ Control de Cobranza:** Sem√°foro visual (Verde/Rojo) para identificar deudores al instante.
* **üë• Gesti√≥n de Alumnos:** Expediente digital con foto, grado (cinta), datos de tutor y emergencia.
* **üìù Toma de Asistencia:** M√≥dulo r√°pido para registrar asistencia diaria.
* **üìä Dashboard Financiero:** Gr√°ficas de ingresos mensuales y reporte de deuda total.
* **üõ°Ô∏è Roles y Seguridad:**
    * **Admin:** Acceso total (Ver dinero, borrar pagos, eliminar alumnos).
    * **Entrenador:** Acceso restringido (Solo ver lista y pasar asistencia).
* **‚òÅÔ∏è Cloud Native:** Base de datos en tiempo real alojada en Supabase.

## üõ†Ô∏è Tecnolog√≠as Utilizadas

* **Frontend:** React.js + Vite
* **Backend / DB:** Supabase (PostgreSQL + Auth + Storage)
* **UI/UX:** CSS Modules (Estilos responsivos personalizados)
* **Gr√°ficas:** Recharts
* **Notificaciones:** Sonner (Toast notifications)

## ‚öôÔ∏è Instalaci√≥n y Configuraci√≥n Local

1.  **Clonar el repositorio:**
    ```bash
    git clone [https://github.com/TU_USUARIO/dojopay.git](https://github.com/TU_USUARIO/dojopay.git)
    cd dojopay
    ```

2.  **Instalar dependencias:**
    ```bash
    npm install
    ```

3.  **Configurar Variables de Entorno:**
    Crea un archivo `.env.local` en la ra√≠z y agrega tus llaves de Supabase:
    ```env
    VITE_SUPABASE_URL=[https://tu-proyecto.supabase.co](https://tu-proyecto.supabase.co)
    VITE_SUPABASE_ANON_KEY=tu-llave-anonima-larga
    ```

4.  **Correr el servidor de desarrollo:**
    ```bash
    npm run dev
    ```

## üóÑÔ∏è Configuraci√≥n de Base de Datos (Supabase SQL)

Para que el sistema funcione, ejecuta estos scripts en el **SQL Editor** de Supabase:

### 1. Tablas Principales
```sql
-- Tabla de Alumnos
CREATE TABLE alumnos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  creado_en TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  nombre TEXT NOT NULL,
  telefono TEXT,
  cinta TEXT DEFAULT 'Blanca',
  foto_url TEXT,
  monto_mensualidad NUMERIC DEFAULT 600,
  dia_corte INT DEFAULT 1,
  activo BOOLEAN DEFAULT TRUE,
  edad INT,
  tutor TEXT,
  emergencia TEXT
);

-- Tabla de Pagos
CREATE TABLE pagos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  fecha_pago TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  alumno_id BIGINT REFERENCES alumnos(id),
  monto NUMERIC NOT NULL,
  concepto TEXT DEFAULT 'Mensualidad',
  registrado_por TEXT -- Para auditor√≠a
);

-- Tabla de Asistencias
CREATE TABLE asistencias (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  alumno_id BIGINT REFERENCES alumnos(id),
  fecha DATE DEFAULT CURRENT_DATE
);

-- Tabla de Perfiles (Roles)
CREATE TABLE perfiles (
  id UUID REFERENCES auth.users NOT NULL PRIMARY KEY,
  rol TEXT DEFAULT 'entrenador' -- 'admin' o 'entrenador'
);

2. Seguridad (Row Level Security)
SQL

-- Habilitar RLS
ALTER TABLE alumnos ENABLE ROW LEVEL SECURITY;
ALTER TABLE pagos ENABLE ROW LEVEL SECURITY;
ALTER TABLE asistencias ENABLE ROW LEVEL SECURITY;
ALTER TABLE perfiles ENABLE ROW LEVEL SECURITY;

-- Pol√≠ticas de Acceso (Permitir todo a usuarios logueados)
CREATE POLICY "Acceso total alumnos" ON alumnos FOR ALL USING (auth.role() = 'authenticated');
CREATE POLICY "Acceso total pagos" ON pagos FOR ALL USING (auth.role() = 'authenticated');
CREATE POLICY "Acceso total asistencias" ON asistencias FOR ALL USING (auth.role() = 'authenticated');
CREATE POLICY "Ver perfiles" ON perfiles FOR SELECT USING (true);
3. Almacenamiento (Storage)
Crear un Bucket p√∫blico llamado avatars.

Configurar pol√≠tica para permitir subida de archivos a usuarios autenticados.

üë§ Gesti√≥n de Usuarios
El sistema utiliza un "Login H√≠brido".

En Supabase: Crear usuario como usuario@dojo.com.

En la App: El usuario puede iniciar sesi√≥n escribiendo solo usuario.

Roles: Para hacer Admin a un usuario, insertar su ID en la tabla perfiles:

SQL

INSERT INTO perfiles (id, rol) VALUES ('UID_DEL_USUARIO', 'admin');
üì¶ Despliegue (Deploy)
Este proyecto est√° optimizado para Vercel.

Subir c√≥digo a GitHub.

Importar proyecto en Vercel.

Configurar las Environment Variables en Vercel con las llaves de Supabase.

¬°Listo!
